---
title: "Juvenile Snowshoe Hares in the Bonanza Creek Experimental Forest"
author: "Taylor Medina"
date: "11/2/2021"
output: 
  html_document: 
    toc: yes
    theme: paper
    number_sections: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(here)
library(kableExtra)
library(lubridate)
library(plotly)
library(effsize)
library(broom)
library(equatiomatic)
```

# Introduction

# Data and Analyses
# Juvenile Hare Investigation
## Annual Juvenile Hare Trap Counts
```{r, message = FALSE}
bonanza_hares <- read_csv(here("data", "bonanza_hares.csv"))

hare_trappings <- bonanza_hares %>% 
  mutate(date = mdy(date), # convert class of date column
         year = year(date)) %>% # splice out year
  group_by(year) %>% 
  summarize(trappings = n()) # get number of trappings per year
```

```{r}
hare_plot <- ggplot(data = hare_trappings,
                    aes(x = year, y = trappings)) +
  geom_point() +
  geom_line() +
  theme_classic() +
  labs(x = "year",
       y = "number of trappings")

ggplotly(hare_plot)
```
**Figure 1:** Time series plot of the total number of hare-trappings performed from 1998 - 2012

```{r}
hare_summary <- hare_trappings %>% 
  summarize(mean_trap = round(mean(trappings), 0),
            sd_trap = round(sd(trappings), 0),
            median_trap = median(trappings),
            max_trap = max(trappings),
            min_trap = min(trappings))
```

The maximum number of trappings per year is `r hare_summary$max_trap` which was done in 2009. The minimum number of trappings per year is `r hare_summary$min_trap` which was done in 2002. The average number of trappings done per year over the experiment is `r hare_summary$mean_trap` and the median number of trappings is `r hare_summary$median_trap`. There are random amount of trappings performed per year and there are no years with the same amount of trappings. This could be due to the difficulty of trapping young hares or seasonal variability in their populations. To standardize the experiment a bit better, the same number of traps and the same time-frames for the trappings should be done every year in order to account for population variance over different seasons and decrease the likelihood of having such a high sampling range depending on the year,


## Visualize Juvenile Hare Weights
```{r, message = FALSE}
hare_weights <- bonanza_hares %>% 
  group_by(grid, sex) %>% 
  summarize(mean_weight = mean(weight, na.rm = TRUE),
            sd_weight = sd(weight, na.rm = TRUE)) %>%
  mutate(grid = case_when( # replace short names of sites with full names
    grid == "bonbs" ~ "Bonanza Lowland",
    grid == "bonmat" ~ "Bonanza Mature",
    grid == "bonrip" ~ "Bonanza Riparian"))
 
x_axis <- c("female", "male", "NA") # define x-axis labels since they are strings

weight_plot <- ggplot(data = hare_weights,
                      aes(x = sex, y = mean_weight)) +
  geom_bar(stat = "identity", aes(fill = sex)) +
  geom_errorbar(data = hare_weights, 
                mapping = aes(x = sex, ymin = mean_weight - sd_weight, 
                              ymax = mean_weight + sd_weight, size = 0.2, width = 0.1)) +
  facet_wrap(~ grid) +
  theme_classic() +
  scale_y_continuous(expand = c(0,1)) +
  scale_x_discrete(labels = x_axis) + # manually define x-axis
  theme(legend.position = "none") +
  labs(x = "sex",
       y = "mass (g)")
  

ggplotly(weight_plot)
```
**Figure 2:** Bar chart comparing the average masses of female, male, and unknown gendered juvenile hares. The error bars represent the standard deviation of the sample masses. NA represents an unknown gender.

Overall, according to **Figure 2**, there is no clear indication on which gender is heavier. In the Bonanza Lowland site, females are lighter than males and unknown gendered hares, with NA hares having a higher variation in their masses. IN the Bonanza Mature site, males hare the heaviest but both females and unkown gendered hares have higher variances in their masses. In the Bonanza Riparian site, females have the largest mass while unknown gendered hares have the most variance. 

## Juvenile Weight Comparison
```{r}
hare_stats <- bonanza_hares %>% 
  group_by(sex) %>% 
  summarize(mean_weight = round(mean(weight, na.rm = TRUE), 1),
            sd_weight = round(sd(weight, na.rm = TRUE), 2),
            sample_size = n()) %>% 
  filter(sex != "") %>% # remove na row
  mutate(sex = case_when(
    sex == "f" ~ "female",
    sex == "m" ~ "male"))

  
hare_stats %>%
  kable(col.names = c("sex",
                      "mean weight (g)",
                      "standard deviation (g)",
                      "sample size"),
        caption = "Table 1: Mean weights with standard deviation of Bonanza Hares") %>% 
  kable_classic(full_width = FALSE) %>% 
  row_spec(0:2, align = "center")
```

```{r, include = FALSE}
hare_stats_1 <- bonanza_hares %>% 
  group_by(sex) %>% 
  summarize(weight = weight) 

ggplot(data = hare_stats_1, aes(x = weight)) +
  geom_bar() + 
  facet_wrap(~ sex)

ggplot(data = hare_stats_1, aes(sample = weight)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~ sex)
```

```{r}
female_hares <- subset(hare_stats_1, sex == "f") %>% 
  na.omit() # omit na values

male_hares <- subset(hare_stats_1, sex == "m") %>% 
  na.omit() # omit na values

mean_diff = hare_stats$mean_weight[1] - hare_stats$mean_weight[2] # calculates difference in mean female vs. male height
cohen <- cohen.d(female_hares$weight, male_hares$weight) # performs a cohen D test to get the effect size
ttest <- t.test(female_hares$weight, male_hares$weight) # performs an unpaired 2-sample t-test

hare_analysis <- as.data.frame(t(c(mean_diff, cohen$estimate, ttest$p.value))) # puts results into a data frame
```

Female juvenile hares have a slightly higher mean mass than male hares according to **Table 1**, with the difference in these mean masses being `r round(mean_diff,1)` grams. To determine if this difference was statistically significantly, a standard unpaired two sample t-test was performed. The null hypothesis was that the mean mass of females and males is the same. The alternate hypothesis is that the mean mass of females and males is different. The t-test was performed and a p-value of `r round(ttest$p.value, 3)` was found, meaning there is a `r round(ttest$p.value * 100, 3)`% chance that two samples of different gender juvenile hares would have a difference in means of at least `r round(mean_diff, 1)`, assuming the two samples are from the sample population.

## Relationship between juvenile weight & hind foot length
```{r, warning = FALSE}
hare_foot <- bonanza_hares %>% 
  select(sex, weight, hindft)

foot_plot <- ggplot(data = hare_foot, aes(x = weight, y = hindft)) +
  geom_point() +
  scale_x_continuous(expand = c(0,0)) +
  theme_classic() +
  labs(x = "weight (g)",
       y = "hind foot length (mm)") 
                      
ggplotly(foot_plot)                
```
**Figure 3:** Scatterplot showing the relationship between hare weight in grams compared to their hind foot length in millimeters.

```{r, warning = FALSE, message = FALSE}
hare_lm <- lm(hindft ~ weight, data = hare_foot) # performs ordinary least squares regression

lm_tidy <- tidy(hare_lm)

lm_glance <- glance(hare_lm) %>% 
  mutate(slope = lm_tidy$estimate[1], # extracts slope value from model fit
         intercept = lm_tidy$estimate[2], # extracts intercept value from model fit
         pearson = sqrt(adj.r.squared)) %>% # calculates Pearson Correlation
  select(slope, intercept, adj.r.squared, pearson)

lm_glance %>%
  round(4) %>% 
  kable(col.names = c("intercept",
                      "slope",
                      "$R^2$",
                      "Pearson correlation"),
        caption = "Table 2: Ordinary Least Squares Regression Summary ") %>% 
  kable_classic(full_width = FALSE) %>% 
  row_spec(0:1, align = "center")
```

```{r}
extract_eq(model = hare_lm, use_coefs = TRUE)
```

# Conclusion
# Citations